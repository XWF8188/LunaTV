# 卡密系统前端界面说明

## 概述

卡密系统的前端界面已实现完成，包括管理员后台的卡密管理功能和用户设置页面的卡密绑定功能。

## 新增组件

### 1. CardKeyManager - 管理员卡密管理组件

**文件位置**: `src/components/CardKeyManager.tsx`

**功能特性**:

- ✅ 创建卡密（支持批量生成，最多100个）
- ✅ 查看卡密列表（显示哈希、类型、状态、创建/过期时间、绑定用户）
- ✅ 删除未使用的卡密
- ✅ 清理过期的未使用卡密
- ✅ 导出卡密列表为 CSV 文件
- ✅ 刷新卡密列表

**界面截图**:

```
卡密管理
┌─────────────────────────────────────────────────────────┐
│ [创建卡密] [导出] [清理过期] [刷新] [关闭]          │
├─────────────────────────────────────────────────────────┤
│ 卡密哈希   │ 类型  │ 状态  │ 创建时间  │ 过期时间 │ 绑定用户 │ 操作 │
│────────────┼───────┼───────┼───────────┼──────────┼──────────┼──────│
│ 6294d...   │ 1周   │ 已使用 │ ...      │ ...      │ testuser │      │
│ 02201...   │ 1周   │ 未使用 │ ...      │ ...      │ -       │ [删除]│
└────────────┴───────┴───────┴───────────┴──────────┴──────────┴──────┘
```

**卡密状态标识**:

- 🟢 **已使用** - 卡密已被用户绑定使用
- ⚪ **未使用** - 卡密尚未被使用，可以删除
- 🔴 **已过期** - 卡密已过期，无法使用

### 2. UserCardKeyBinding - 用户卡密绑定组件

**文件位置**: `src/components/UserCardKeyBinding.tsx`

**功能特性**:

- ✅ 查看当前卡密状态
- ✅ 显示过期提醒（30天内、7天内、已过期）
- ✅ 绑定新卡密
- ✅ 重新绑定卡密延长有效期
- ✅ 刷新卡密状态

**界面状态**:

**未绑定卡密**:

```
┌─────────────────────────────────────────────────────────┐
│ 卡密管理                                                    [刷新]       │
├─────────────────────────────────────────────────────────┤
│ ⚠️ 未绑定卡密                                             │
│                                                             │
│ 您需要绑定卡密才能使用系统功能。请联系管理员获取卡密。      │
│                                                             │
│ 卡密: [___________________]                                 │
│                                                             │
│ [绑定卡密]                                                 │
└─────────────────────────────────────────────────────────┘
```

**已绑定卡密（正常）**:

```
┌─────────────────────────────────────────────────────────┐
│ 卡密管理                                                    [刷新]       │
├─────────────────────────────────────────────────────────┤
│ ✅ 已绑定卡密                                             │
│                                                             │
│ 过期时间: 2026-02-19 06:14:59                              │
│ 剩余天数: 7 天                                             │
│ 状态: [正常]                                               │
│                                                             │
│ 重新绑定卡密                                               │
│                                                             │
│ 绑定新卡密可以延长您的账户有效期。                          │
│                                                             │
│ 新卡密: [___________________]                                │
│                                                             │
│ [绑定新卡密]                                               │
└─────────────────────────────────────────────────────────┘
```

**已绑定卡密（即将过期）**:

```
┌─────────────────────────────────────────────────────────┐
│ 卡密管理                                                    [刷新]       │
├─────────────────────────────────────────────────────────┤
│ ⚠️ 卡密即将过期                                          │
│                                                             │
│ 您的卡密将在 7 天后过期，请及时续费。                        │
│                                                             │
│ ...已绑定卡密信息...                                       │
└─────────────────────────────────────────────────────────┘
```

**已绑定卡密（已过期）**:

```
┌─────────────────────────────────────────────────────────┐
│ 卡密管理                                                    [刷新]       │
├─────────────────────────────────────────────────────────┤
│ ❌ 卡密已过期                                              │
│                                                             │
│ 您的卡密已过期，请立即绑定新卡密以继续使用系统。              │
│                                                             │
│ ...已绑定卡密信息...                                       │
└─────────────────────────────────────────────────────────┘
```

## 新增页面

### /settings - 用户设置页面

**文件位置**: `src/app/settings/page.tsx`

**访问路径**: `http://localhost:3000/settings`

**功能**: 提供用户绑定和管理卡密的界面

## 管理后台集成

### 卡密管理标签

在管理后台（`/admin`）中添加了"卡密管理"标签，位于：

- 仅管理员（owner/admin）可见
- 位置：在所有配置标签列表中，位于"性能监控"标签之后
- 图标：🔑 (KeyRound)
- 颜色：蓝色

**导航路径**: `/admin` → "卡密管理" 标签

## 功能流程

### 管理员创建卡密流程

1. 登录管理后台（`/admin`）
2. 点击"卡密管理"标签
3. 点击"创建卡密"按钮
4. 选择卡密类型（1年/1季/1月/1周）
5. 输入生成数量（1-100）
6. 点击"创建"按钮
7. 查看并复制生成的卡密（明文，仅显示一次）
8. 分配卡密给用户

### 用户绑定卡密流程

1. 访问设置页面（`/settings`）
2. 如果未绑定卡密，输入管理员提供的卡密
3. 点击"绑定卡密"按钮
4. 查看卡密状态和过期时间
5. 卡密即将过期时，重新绑定新卡密

### 卡密过期提醒

| 剩余天数 | 提示样式           | 提示位置                  |
| -------- | ------------------ | ------------------------- |
| > 30天   | 绿色"正常"状态     | 卡密状态卡片              |
| 1-30天   | 黄色"即将过期"警告 | 卡密状态卡片 + 顶部警告框 |
| 0天      | 红色"已过期"警告   | 卡密状态卡片 + 顶部警告框 |

### 卡密管理操作

| 操作         | 权限要求    | 说明                     |
| ------------ | ----------- | ------------------------ |
| 创建卡密     | owner/admin | 可批量创建               |
| 查看卡密列表 | owner/admin | 显示所有卡密信息         |
| 删除卡密     | owner/admin | 仅可删除未使用卡密       |
| 清理过期卡密 | owner/admin | 批量清理过期未使用卡密   |
| 导出卡密     | owner/admin | 导出为 CSV 文件          |
| 绑定卡密     | 所有用户    | 普通用户和管理员都可绑定 |
| 查看卡密状态 | 所有用户    | 查看自己的卡密状态       |

## 卡密类型

| 类型    | 有效期 | 标签显示    |
| ------- | ------ | ----------- |
| year    | 365天  | 1年         |
| quarter | 90天   | 1季（90天） |
| month   | 30天   | 1月（30天） |
| week    | 7天    | 1周（7天）  |

## API 接口调用

### 管理员接口

```typescript
// 创建卡密
POST /api/admin/cardkey
{
  "action": "create",
  "type": "week",
  "count": 3
}

// 获取卡密列表
GET /api/admin/cardkey

// 删除未使用卡密
DELETE /api/admin/cardkey?hash={hash}

// 清理过期卡密
POST /api/admin/cardkey
{
  "action": "cleanup"
}

// 导出卡密
GET /api/admin/cardkey/export
```

### 用户接口

```typescript
// 获取卡密状态
GET /api/user/cardkey

// 绑定卡密
POST /api/user/cardkey
{
  "cardKey": "明文卡密"
}
```

## UI 组件复用

前端界面使用了项目现有的组件和样式系统：

- **按钮样式**: 使用 `buttonStyles` 对象中的预定义样式
- **图标**: 使用 `lucide-react` 图标库
- **布局**: 使用 Tailwind CSS 响应式布局
- **颜色**: 使用项目的深色模式配色方案

## 后续优化建议

1. **前端验证**:
   - 添加卡密格式验证
   - 添加批量创建的数量限制验证
   - 添加新卡密过期时间验证

2. **用户体验优化**:
   - 添加卡密复制成功提示
   - 添加加载动画
   - 添加分页功能（大量卡密时）
   - 添加搜索/筛选功能

3. **功能增强**:
   - 添加卡密使用历史查看
   - 添加卡密批量导出为图片
   - 添加卡密二维码生成
   - 添加卡密分享功能

4. **移动端适配**:
   - 优化表格在移动端的显示
   - 添加移动端抽屉式菜单
   - 优化按钮触摸区域大小

---

**创建时间**: 2026-02-12
**版本**: 1.0.0
**作者**: AI Coding Agent
